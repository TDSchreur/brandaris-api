trigger:
  - master

pr:
  - master

resources:
  - repo: self

variables:
  
  configuration: 'release'
  pool: Default

stages:
 - stage: Build
   jobs:
     - job: Build
       pool: $(pool)
       steps:
        - task: DotNetCoreCLI@2
          displayName: restore
          inputs:
            command: 'restore'
            projects: 'src/api/api.csproj'
            feedsToUse: 'select'

        - task: DotNetCoreCLI@2
          displayName: build
          inputs:
            command: 'build'
            projects: 'src/api/api.csproj'
            arguments: '--no-restore -c ${configuration}'

        - task: DotNetCoreCLI@2
          displayName: poublish
          inputs:
            command: 'publish'
            projects: 'src/api/api.csproj'
            zipAfterPublish: true
            arguments: '--no-build -c ${configuration} -o $(Build.ArtifactStagingDirectory)'
            
        - task: PublishBuildArtifacts@1
          inputs:
            PathtoPublish: '$(Build.ArtifactStagingDirectory)'
            ArtifactName: 'drop'
            publishLocation: 'Container'